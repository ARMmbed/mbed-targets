Support auto mode and add public API.
